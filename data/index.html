<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=windows-1252">
  <title>ESP32-Cam WiFiSetup</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>
  <header>
    <h1>ESP32 Camera</h1>
  </header>
  <div class="box">
    <h1>WiFi-Setup</h1>

    <table class="wifiListTable" cellspacing="0" cellpadding="0" border="0">
      <tbody>

        <tr>
          <td style="border: 0" class="tdName">
            <h3 id="wifiId1">WiFi-Name1</h3>
          </td>
          <td style="border: 0" class="tdButton"> <button id="1" type="button"
              onClick="showPopup(this.id, wifiId1.textContent)" class="selectWifiButton">Connect to it!</button> </td>
        </tr>

        <tr>
          <td colspan="2">
            <hr>
          </td>
        </tr>

        <tr>
          <td style="border: 0" class="tdName">
            <h3 id="wifiId2">WiFi-Name2</h3>
          </td>
          <td style="border: 0" class="tdButton"> <button id="2" type="button"
              onClick="showPopup(this.id, wifiId2.textContent)" class="selectWifiButton">Connect to it!</button> </td>
        </tr>

      </tbody>
    </table>
  </div>



  <form action="/" method="post" id="my-form">

    <div class="popup_overlay" style="width: 100%; height: 100%;">
      <div class="popup-content">
        <h1 id="popupWifiName" style="color: white;">nameplaceholder</h1>
        <input id="wifiName" type="hidden" name="networkName" value="" />
        <h5 style="color: white;">Please put in below the password of the network to connect.</h5>
        <div class="part">
          <input id="inputPassword" class="inputPassword" required="required" placeholder="Password"
            name="networkPassword" value="" type="password">
            <label id="errorLabel" class="errorLabel">ERROR HERE</label>
        </div>

        <button type="submit" class="connectToWifiButton" onClick="showLoading()">Connect!</button>

        <div style="width: 100%; height: 100%; display: flex; justify-content: end;">
          <button type="button" class="closePopupButton" onClick="closePopup()">X</button>
        </div>
      </div>
    </div>

  </form>

  <div class="loader_overlay" style="width: 100%; height: 100%;">
    <div class="loader-content">
    </div>
  </div>


  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

  <script type="text/javascript">
    function showPopup(button_id, stringwifi) {
      $(".popup_overlay").hide().fadeIn(300);
      document.getElementById("popupWifiName").textContent = stringwifi;
      document.getElementById("wifiName").value = stringwifi;
      document.getElementById("inputPassword").value = "";
      document.getElementById("errorLabel").hide(0);
    }
    function closePopup() {
      $(".popup_overlay").fadeOut(300);
    }

    function showLoading() {
      if (document.getElementById("inputPassword").value != "") {
        $(".loader_overlay").fadeIn(100);
      }
    }
    function hideLoading() {
      $(".loader_overlay").fadeOut(300);
    }

    $("#my-form").submit(function (e) {
      e.preventDefault();
      var form = $(this);
      var url = form.attr('action');
      console.log("TEST1");
      $.ajax({
        type: "POST",
        url: url,
        data: form.serialize(),
        success: function (data) {

        },
        error: function (data) {
          if (data.status == 401) {
            console.log("TEST3");
            hideLoading();
            showPasswordError();
          }
        }
      });
    });
    function showPasswordError() {
      console.log("SHOW PASSWORD ERROR LABEL");
      $(".errorLabel").show().delay(10000).fadeOut();
    }

  </script>
</body>

</html>